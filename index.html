<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Departamento de Administración de Empresas y Marketing | Universidad de Sevilla</title>
	<!-- Tailwind CSS -->
	<script src="https://cdn.tailwindcss.com"></script>
	<!-- Academicons -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
	<!-- Lucide -->
	<script src="https://unpkg.com/lucide@latest"></script>
	<!-- PapaParse -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
	<!-- Google Fonts: Inter -->
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;800&display=swap" rel="stylesheet">
	<style>
		body {
			font-family: 'Inter', system-ui, -apple-system, sans-serif;
			background-color: #fafafa;
			color: #334155;
			background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
			background-size: 24px 24px;
		}
		.text-us-red { color: #B30A1B; }
		.bg-us-red { background-color: #B30A1B; }
		.border-us-red { border-color: #B30A1B; }
		.hover-card { transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); }
		.hover-card:hover {
			transform: translateY(-4px);
			box-shadow: 0 12px 24px -10px rgba(179, 10, 27, 0.15);
			border-color: rgba(179, 10, 27, 0.3);
		}
		.fade-in { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
		@keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
		.hidden-section { display: none; }
		.loading-screen { position: fixed; inset: 0; background: white; z-index: 100; display: flex; align-items: center; justify-content: center; flex-direction: column; }
		.hero-blob { position: absolute; filter: blur(80px); opacity: 0.08; z-index: 0; pointer-events: none; }
		.btn-primary { position: relative; overflow: hidden; transition: all 0.3s ease; }
		.btn-primary:after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; background-color: #B30A1B; transform: scaleX(0); transform-origin: bottom right; transition: transform 0.4s cubic-bezier(0.86, 0, 0.07, 1); z-index: -1; }
		.btn-primary:hover:after { transform: scaleX(1); transform-origin: bottom left; }
		.btn-primary:hover { color: white; }
		.scrollbar-hide::-webkit-scrollbar { display: none; }
		.scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
		@media (max-width: 768px) { .hero-bg { background-image: none !important; } }
		#desktop-nav button, #mobile-nav-items button { font-family: 'Inter', sans-serif; font-weight: 400; color: #374151; letter-spacing: 0.01em; }
		#desktop-nav button:hover, #mobile-nav-items button:hover { color: #111827; }
	</style>
</head>

<body class="selection:bg-[#B30A1B] selection:text-white overflow-x-hidden">
	<!-- PANTALLA DE CARGA -->
	<div id="loading-screen" class="loading-screen">
		<div class="animate-spin rounded-full h-12 w-12 border-b-2 border-us-red mb-4"></div>
		<p class="text-gray-500 font-medium animate-pulse">Cargando datos del departamento...</p>
	</div>

	<!-- HEADER -->
	<header class="fixed top-0 left-0 right-0 bg-white/80 backdrop-blur-lg z-50 border-b border-gray-100 h-20">
		<div class="container mx-auto px-6 md:px-12 flex justify-between items-center h-full">
			<div class="flex items-center gap-4 cursor-pointer group" onclick="switchSection('inicio')">
				<img src="img/simbolo.png" alt="Logo ADEMARK" class="w-[70px] h-[70px] object-contain group-hover:rotate-3 transition-transform duration-300" onerror="this.src='https://via.placeholder.com/70x70?text=US'">
				<div class="leading-none">
					<h1 class="font-bold text-gray-900 tracking-tight text-lg">ADEMARK</h1>
					<p class="text-[10px] uppercase tracking-[0.2em] text-gray-400 font-semibold mt-1">Universidad de Sevilla</p>
				</div>
			</div>
			<nav class="hidden xl:flex items-center gap-2" id="desktop-nav"></nav>
			<button class="xl:hidden p-2 text-gray-600 hover:text-us-red" onclick="toggleMobileMenu()"> <i data-lucide="menu"></i> </button>
		</div>
	</header>

	<!-- MOBILE MENU -->
	<div id="mobile-menu" class="fixed inset-0 z-40 bg-white/98 backdrop-blur-xl pt-32 px-8 pb-10 overflow-y-auto hidden xl:hidden fade-in">
		<nav class="flex flex-col gap-6" id="mobile-nav-items"></nav>
		<button onclick="toggleMobileMenu()" class="absolute top-6 right-6 p-4 text-gray-400 hover:text-us-red"> <i data-lucide="x" width="32" height="32"></i> </button>
	</div>

	<!-- MAIN CONTENT -->
	<main class="pt-32 pb-24 min-h-screen container mx-auto px-6 md:px-12 max-w-7xl relative hidden" id="main-content">
		<div class="hero-blob bg-us-red w-96 h-96 rounded-full -top-20 -left-20"></div>
		<div class="hero-blob bg-blue-900 w-96 h-96 rounded-full bottom-0 right-0"></div>

		<!-- INICIO -->
		<section id="inicio" class="section-layer fade-in relative z-10">
			<div class="relative overflow-hidden rounded-3xl mb-10 sm:mb-20">
				<div class="absolute inset-0 bg-cover bg-center hero-bg" style="background-image:url('img/fondo/pexels-jplenio-1445335.jpg');"></div>
				<div class="absolute inset-0 bg-gradient-to-r from-white/95 via-white/80 to-transparent"></div>
				<div class="relative z-10 px-6 sm:px-10 py-8 sm:py-16">
					<div class="lg:col-span-8 space-y-8 self-center">
						<div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-red-50 border border-red-100 text-us-red text-xs font-bold uppercase tracking-wider">
							<span class="relative flex h-2 w-2">
								<span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
								<span class="relative inline-flex rounded-full h-2 w-2 bg-us-red"></span>
							</span> Administración de Empresas y Marketing
						</div>
						<h1 class="text-[2.75rem] sm:text-5xl md:text-8xl font-extrabold text-gray-900 leading-[1.1] tracking-tight">
							Formando en <span class="text-transparent bg-clip-text bg-gradient-to-r from-[#B30A1B] to-[#e11d48]">Organización y Marketing.</span>
						</h1>
						<p class="text-xl text-gray-500 leading-relaxed max-w-2xl font-light">Excelencia académica e investigación de vanguardia en la Universidad de Sevilla.</p>
						<div class="flex flex-wrap gap-4 pt-4">
							<button onclick="switchSection('oferta')" class="btn-primary px-8 py-4 bg-gray-900 text-white rounded-lg font-semibold shadow-lg shadow-gray-200">Explorar Oferta</button>
							<button onclick="switchSection('investigacion')" class="group px-8 py-4 bg-white border border-gray-200 text-gray-700 rounded-lg font-medium hover:border-us-red hover:text-us-red flex items-center gap-2">Investigación <i data-lucide="arrow-right" class="w-4 h-4 group-hover:translate-x-1 transition-transform"></i></button>
						</div>
					</div>
				</div>
			</div>

			<div class="grid md:grid-cols-2 gap-6 mb-12">
				<div class="bg-white p-8 rounded-xl border border-gray-100 hover-card">
					<div class="flex items-center gap-4 mb-4">
						<div class="w-12 h-12 bg-orange-50 text-orange-600 rounded-lg flex items-center justify-center"> <i data-lucide="briefcase"></i> </div>
						<h3 class="text-2xl font-bold text-gray-900">Organización de Empresas</h3>
					</div>
					<p class="text-gray-500">Impulsamos la eficiencia y el liderazgo organizacional. <span class="font-bold text-red-600">73 docentes</span>.</p>
				</div>
				<div class="bg-white p-8 rounded-xl border border-gray-100 hover-card">
					<div class="flex items-center gap-4 mb-4">
						<div class="w-12 h-12 bg-green-50 text-green-600 rounded-lg flex items-center justify-center"> <i data-lucide="bar-chart-2"></i> </div>
						<h3 class="text-2xl font-bold text-gray-900">Comercialización e Investigación</h3>
					</div>
					<p class="text-gray-500">Analizamos el valor de marca y mercados. <span class="font-bold text-red-600">46 docentes</span>.</p>
				</div>
			</div>

			<div id="noticias-home-container" class="grid grid-cols-1 md:grid-cols-2 gap-4 pt-8 border-t border-gray-100">
				<p class="text-gray-400 italic">Cargando noticias...</p>
			</div>
		</section>

		<!-- OFERTA ACADÉMICA -->
		<section id="oferta" class="section-layer hidden-section fade-in">
			<h2 class="text-4xl font-bold text-gray-900 mb-8">Oferta Académica</h2>
			<div id="grados-wrapper" class="hidden mb-12">
				<div id="grados-container"></div>
			</div>
		</section>

		<!-- PROFESORADO -->
		<section id="profesorado" class="section-layer hidden-section fade-in">
			<div class="flex flex-col md:flex-row justify-between items-end mb-12 gap-6">
				<h2 class="text-4xl font-bold text-gray-900">Profesorado</h2>
				<div class="relative w-full md:w-96 group">
					<input type="text" id="profesor-search" placeholder="Buscar docente..." class="w-full pl-12 pr-10 py-4 border rounded-xl outline-none transition-all focus:border-us-red focus:ring-4 focus:ring-red-50">
					<div class="absolute left-4 top-4 text-gray-400"> <i data-lucide="search" width="20"></i> </div>
					<button id="clear-search" class="absolute right-3 top-1/2 -translate-y-1/2 p-2 hidden" onclick="clearSearch()"><i data-lucide="x" width="18"></i></button>
				</div>
			</div>
			<div id="profesores-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
		</section>

		<!-- INVESTIGACIÓN -->
		<section id="investigacion" class="section-layer hidden-section fade-in">
			<h2 class="text-4xl font-bold text-gray-900 mb-8">Investigación</h2>
			<div id="investigacion-news-grid" class="grid md:grid-cols-3 gap-6 mb-12"></div>
			<div class="mb-16 relative group/slider">
				<h3 class="text-2xl font-bold mb-6">Grupos de Investigación</h3>
				<div id="grupos-slider" class="flex gap-6 overflow-x-auto pb-8 pt-4 px-4 -mx-4 scrollbar-hide scroll-smooth"></div>
			</div>
		</section>

		<!-- ADMINISTRACIÓN -->
		<section id="administracion" class="section-layer hidden-section fade-in">
			<h2 class="text-4xl font-bold text-gray-900 mb-8">Administración</h2>
			<div id="comisiones-container" class="space-y-6"></div>
		</section>

		<!-- CONTACTO -->
		<section id="contacto" class="section-layer hidden-section fade-in">
			<h2 class="text-4xl font-bold text-gray-900 mb-8">Contacto</h2>
			<div class="bg-white rounded-3xl border border-gray-100 overflow-hidden grid lg:grid-cols-2">
				<div class="p-10 lg:p-14 space-y-10">
					<div>
						<h4 class="font-bold text-gray-900 mb-2">Ubicación</h4>
						<p class="text-gray-500">Av. San Francisco Javier, 24. 41018 Sevilla</p>
					</div>
					<div class="bg-gray-50 p-6 rounded-xl border border-gray-100">
						<h4 class="text-xs font-bold text-gray-400 uppercase mb-2">Horario</h4>
						<p class="text-gray-800">Lunes – Viernes: 12:00 a 14:00 horas</p>
					</div>
				</div>
				<div class="bg-gray-200 min-h-[400px]">
					<iframe src="https://www.google.com/maps?q=37.3788902,-5.9779469&hl=es&z=17&output=embed" class="w-full h-full border-0"></iframe>
				</div>
			</div>
		</section>
	</main>

	<!-- FOOTER -->
	<footer class="border-t border-gray-200 py-12 bg-white text-center text-sm">
		<img src="img/simbolo.png" alt="Logo US" class="w-[40px] mx-auto opacity-50 mb-4">
		<p class="text-gray-500">© <span id="year"></span> Departamento de Administración de Empresas y Marketing.</p>
	</footer>

	<!-- MODALES -->
	<div id="profesor-modal" class="fixed inset-0 bg-gray-900/60 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm opacity-0 transition-opacity duration-300" onclick="closeModalDirect()">
		<div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto p-10 relative" onclick="event.stopPropagation()">
			<button onclick="closeModalDirect()" class="absolute top-6 right-6 p-2 text-gray-400 hover:text-gray-900"> <i data-lucide="x"></i> </button>
			<div id="modal-body-content"></div>
		</div>
	</div>
	<div id="news-modal" class="fixed inset-0 bg-gray-900/60 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm opacity-0 transition-opacity duration-300" onclick="closeNewsModalDirect()">
		<div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto p-10 relative" onclick="event.stopPropagation()">
			<button onclick="closeNewsModalDirect()" class="absolute top-6 right-6 p-2 text-gray-400 hover:text-gray-900"> <i data-lucide="x"></i> </button>
			<div id="news-modal-body"></div>
		</div>
	</div>

	<!-- SCRIPTS -->
	<script>
		// Encapsulamiento
		(function() {
			let CSV_PROFESORES = [], CSV_PROFESORES_PERFIL = [], CSV_PROFESORES_CENTROS = [], CSV_PROFESORES_ASIGNATURAS = [], CSV_INVESTIGADORES = [], NEWS_DATA = [], GRADOS_DATA = [];
			let NEWS_INDEX = { evento: [], noticia: [], investig: [], estudiantes: [] };

			const MENU_ITEMS = [
				{ id: 'inicio', label: 'Inicio' }, { id: 'oferta', label: 'Oferta' }, { id: 'profesorado', label: 'Profesorado' },
				{ id: 'investigacion', label: 'Investigación' }, { id: 'administracion', label: 'Administración' }, { id: 'contacto', label: 'Contacto' }
			];

			async function init() {
				try {
					const results = await Promise.all([
						fetchCsv('out/profesores.csv'), fetchCsv('out/profesores_perfil.csv'), fetchCsv('out/profesores_centros.csv'),
						fetchCsv('out/profesores_asignaturas.csv'), fetchCsv('out/investigadores.csv'), fetchJson('json/noticias.json'),
						fetchJson('json/grados.json').catch(() => [])
					]);
					CSV_PROFESORES = results[0]; CSV_PROFESORES_PERFIL = results[1]; CSV_PROFESORES_CENTROS = results[2];
					CSV_PROFESORES_ASIGNATURAS = results[3]; CSV_INVESTIGADORES = results[4]; NEWS_DATA = results[5].map((n, i) => ({...n, _id: i}));
					GRADOS_DATA = results[6];

					document.getElementById('loading-screen').style.display = 'none';
					document.getElementById('main-content').classList.remove('hidden');
					renderMenu();
					renderHomeNews();
					renderProfessorsGrid(joinProfessorData());
					renderInvestigacion();
					loadComisiones();
					lucide.createIcons();
				} catch(e) {
					console.error(e);
				}
			}

			async function fetchCsv(url) {
				const r = await fetch(url);
				const t = await r.text();
				return new Promise(res => Papa.parse(t, {header:true, skipEmptyLines:true, complete: results => res(results.data)}));
			}
			async function fetchJson(url) {
				const r = await fetch(url);
				return await r.json();
			}

			function joinProfessorData() {
				return CSV_PROFESORES.map(b => ({...b, ...(CSV_PROFESORES_PERFIL.find(p => p.url_abs === b.url_abs) || {})}));
			}

			function renderMenu() {
				const d = document.getElementById('desktop-nav');
				const m = document.getElementById('mobile-nav-items');
				MENU_ITEMS.forEach(it => {
					const b = document.createElement('button');
					b.textContent = it.label;
					b.className = "px-4 py-2 rounded-full text-sm font-medium transition-all text-gray-500 hover:text-us-red";
					b.onclick = () => switchSection(it.id);
					d.appendChild(b);
					const mb = b.cloneNode(true);
					mb.className = "text-left text-3xl font-bold py-2 text-gray-400";
					mb.onclick = () => switchSection(it.id);
					m.appendChild(mb);
				});
			}

			window.switchSection = function(id) {
				document.querySelectorAll('.section-layer').forEach(s => s.classList.add('hidden-section'));
				const target = document.getElementById(id);
				if(target) target.classList.remove('hidden-section');
				document.getElementById('mobile-menu').classList.add('hidden');
				window.scrollTo(0,0);
			};

			function renderProfessorsGrid(data) {
				const container = document.getElementById('profesores-grid');
				container.innerHTML = data.map(p => {
					const pdiId = p.url_ficha?.match(/pdi=(\d+)/)?.[1] || p.url_abs?.match(/pdi=(\d+)/)?.[1];
					const img = pdiId ? `<img src="out/fotos/${pdiId}.png" class="absolute inset-0 w-full h-full object-cover z-10" onerror="this.style.display='none'">` : '';
					return `<div class="bg-white p-6 border rounded-2xl hover-card cursor-pointer" onclick="openProfessorModal(${JSON.stringify(p).replace(/"/g, '&quot;')})">
						<div class="flex items-center gap-4">
							<div class="w-16 h-16 rounded-full bg-gray-100 overflow-hidden relative">
								<div class="absolute inset-0 flex items-center justify-center text-gray-300"><i data-lucide="user"></i></div>
								${img}
							</div>
							<div>
								<h4 class="font-bold text-gray-900">${p.nombre_listado || ''}</h4>
								<p class="text-xs text-gray-400 font-mono">${p.categoria || 'Docente'}</p>
							</div>
						</div>
					</div>`;
				}).join('');
				lucide.createIcons();
			}

			window.openProfessorModal = function(p) {
				const body = document.getElementById('modal-body-content');
				const asignaturas = CSV_PROFESORES_ASIGNATURAS.filter(a => a.url_abs === p.url_abs);
				body.innerHTML = `<h2 class="text-2xl font-bold mb-4">${p.nombre_listado}</h2>
					<p class="text-us-red mb-6">${p.categoria || ''}</p>
					<div class="grid md:grid-cols-2 gap-8">
						<div>
							<h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-3">Contacto</h3>
							<p class="text-gray-700">${p.email || 'No disponible'}</p>
							<p class="text-gray-700">${p.telefono || ''}</p>
						</div>
						<div>
							<h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-3">Asignaturas</h3>
							<div class="flex flex-wrap gap-2">${asignaturas.map(a => `<span class="px-2 py-1 bg-gray-50 text-xs rounded border">${a.asignatura}</span>`).join('')}</div>
						</div>
					</div>`;
				const m = document.getElementById('profesor-modal');
				m.classList.remove('hidden');
				setTimeout(() => m.classList.remove('opacity-0'), 10);
				lucide.createIcons();
			};

			window.closeModalDirect = function() {
				const m = document.getElementById('profesor-modal');
				m.classList.add('opacity-0');
				setTimeout(() => m.classList.add('hidden'), 300);
			};

			function renderHomeNews() {
				const container = document.getElementById('noticias-home-container');
				container.innerHTML = NEWS_DATA.slice(0, 4).map(n => `
					<div class="bg-white p-6 border rounded-xl hover-card cursor-pointer" onclick="openNewsModal(${n._id})">
						<span class="text-xs font-bold text-us-red">${n.fecha}</span>
						<h4 class="font-bold text-gray-900 mt-2">${n.titulo}</h4>
						<p class="text-sm text-gray-500 mt-2 line-clamp-2">${n.resumen}</p>
					</div>
				`).join('');
			}

			window.openNewsModal = function(id) {
				const n = NEWS_DATA.find(x => x._id === id);
				const body = document.getElementById('news-modal-body');
				body.innerHTML = `<h2 class="text-2xl font-bold mb-4">${n.titulo}</h2>
					<div class="prose text-gray-600">${n.resumen}</div>`;
				const m = document.getElementById('news-modal');
				m.classList.remove('hidden');
				setTimeout(() => m.classList.remove('opacity-0'), 10);
			};

			window.closeNewsModalDirect = function() {
				const m = document.getElementById('news-modal');
				m.classList.add('opacity-0');
				setTimeout(() => m.classList.add('hidden'), 300);
			};

			function renderInvestigacion() {
				const slider = document.getElementById('grupos-slider');
				const grid = document.getElementById('investigacion-news-grid');
				grid.innerHTML = NEWS_DATA.filter(n => n.tipo?.includes('investig')).slice(0, 3).map(n => `
					<div class="bg-white p-6 border rounded-xl border-l-4 border-us-red" onclick="openNewsModal(${n._id})">
						<h4 class="font-bold text-sm">${n.titulo}</h4>
					</div>
				`).join('');

				const grupos = [...new Set(CSV_INVESTIGADORES.filter(i => i.grupo?.includes('SEJ-')).map(i => i.grupo))];
				slider.innerHTML = grupos.map(g => `
					<div class="snap-center shrink-0 w-[300px] bg-blue-50 p-6 rounded-xl border">
						<span class="font-bold text-us-red text-xs">${g.match(/SEJ-\d+/)?.[0] || 'Grupo'}</span>
						<h4 class="font-bold text-gray-900 text-sm mt-2">${g.replace(/SEJ-\d+/, '').trim()}</h4>
					</div>
				`).join('');
			}

			async function loadComisiones() {
				const c = document.getElementById('comisiones-container');
				try {
					const res = await fetch('json/comisiones.json');
					const data = await res.json();
					const renderM = ms => ms.map(m => `<li class="flex justify-between border-t py-2"><span>${m.nombre}</span><span class="text-xs text-gray-400">${m.rol}</span></li>`).join('');
					const renderB = (t, items) => `<div><h4 class="font-bold mb-4 text-us-red">${t}</h4><div class="grid md:grid-cols-2 gap-4">${items.map(i => `<div class="bg-gray-50 p-4 rounded-xl"><h5>${i.nombre}</h5><ul class="mt-2">${renderM(i.miembros)}</ul></div>`).join('')}</div></div>`;
					c.innerHTML = renderB("Estatutarias", data.estatutarias) + renderB("Delegadas", data.delegadas);
				} catch(e) {}
			}

			window.toggleMobileMenu = function() {
				document.getElementById('mobile-menu').classList.toggle('hidden');
			};

			document.getElementById('year').textContent = new Date().getFullYear();
			init();
		})();
	</script>
	<script src="js/countdown_investigacion.js"></script>
</body>

</html>